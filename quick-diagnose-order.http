### ========================================
### 订单不存在 - 快速诊断测试
### ========================================
### 请依次执行，看哪一步失败
### ========================================

### 📋 测试前确认
### 1. 服务是否正在运行？（npm run dev）
### 2. 终端是否有报错？


### ========================================
### 步骤 1：创建锁票
### ========================================
# @name createHold
POST http://localhost:3000/api/holds
Content-Type: application/json

{
  "eventId": 1,
  "tierId": 101,
  "qty": 1
}

### ✅ 期望返回：
### {
###   "ok": true,
###   "data": {
###     "holdId": "H_xxx",
###     "expireAt": 1730...
###   }
### }
###
### ❌ 如果失败，把错误信息复制给我


### ========================================
### 步骤 2：创建订单（自动使用上一步的 holdId）
### ========================================
# @name createOrder
POST http://localhost:3000/api/orders
Content-Type: application/json

{
  "eventId": 1,
  "tierId": 101,
  "qty": 1,
  "holdId": "{{createHold.response.body.$.data.holdId}}"
}

### ✅ 期望返回：
### {
###   "ok": true,
###   "data": {
###     "orderId": "O_xxx",
###     "status": "PENDING"
###   }
### }
###
### ❌ 如果失败，把错误信息复制给我


### ========================================
### 步骤 3：查看所有订单
### ========================================
GET http://localhost:3000/api/orders

### ✅ 期望返回：
### {
###   "ok": true,
###   "data": [
###     {
###       "orderId": "O_xxx",
###       "status": "PENDING",
###       ...
###     }
###   ],
###   "total": 1
### }
###
### ❌ 如果返回 { "ok": true, "data": [], "total": 0 }
###    说明订单没创建成功


### ========================================
### 步骤 4：支付订单（自动使用步骤 2 的 orderId）
### ========================================
POST http://localhost:3000/api/pay/mock
Content-Type: application/json

{
  "orderId": "{{createOrder.response.body.$.data.orderId}}"
}

### ✅ 期望返回：
### {
###   "ok": true,
###   "code": "PAY_SUCCESS",
###   "message": "支付成功",
###   "data": {
###     "status": "PAID"
###   }
### }
###
### ❌ 如果返回 "ORDER_NOT_FOUND"
###    把完整响应复制给我


### ========================================
### 步骤 5：查看已支付订单
### ========================================
GET http://localhost:3000/api/orders?status=PAID

### ✅ 期望返回：
### {
###   "ok": true,
###   "data": [
###     {
###       "orderId": "O_xxx",
###       "status": "PAID",
###       "paidAt": 1730...
###     }
###   ]
### }


### ========================================
### 📋 诊断结果
### ========================================
###
### 请回答：
### 1. 步骤 1（创建锁票）成功了吗？ [ ] 是  [ ] 否
### 2. 步骤 2（创建订单）成功了吗？ [ ] 是  [ ] 否
### 3. 步骤 3（查看订单）有数据吗？ [ ] 是  [ ] 否
### 4. 步骤 4（支付订单）成功了吗？ [ ] 是  [ ] 否
###
### 如果某一步失败了，请：
### 1. 复制完整的响应内容
### 2. 复制终端的错误日志
### 3. 告诉我是第几步失败的
###
### ========================================


### ========================================
### 🐛 故障排查测试
### ========================================

### 测试 A：检查内存存储是否工作
POST http://localhost:3000/api/holds
Content-Type: application/json

{"eventId": 1, "tierId": 101, "qty": 1}

###
### 然后立即查询诊断接口
GET http://localhost:3000/api/holds?eventId=1&tierId=101

### 期望：diagnostics.activeHolds > 0


### 测试 B：手动创建订单测试
### 先创建一个锁票，记住返回的 holdId
### 然后手动填入下面的 holdId
POST http://localhost:3000/api/orders
Content-Type: application/json

{
  "eventId": 1,
  "tierId": 101,
  "qty": 1,
  "holdId": "H_1761752810625_h5fav5"
}


### 测试 C：直接查看所有数据
GET http://localhost:3000/api/orders

### 如果返回空数组，说明订单确实没创建成功
