# ğŸ¨ NFT åŠŸèƒ½å®ç°è¯´æ˜

## ğŸ“‹ å®ç°æ¦‚è§ˆ

æœ¬æ¬¡å®ç°ä¸ºç¥¨æ¬¡å…ƒç½‘ç«™æ·»åŠ äº†å®Œæ•´çš„ NFT åŠŸèƒ½æ¡†æ¶ï¼ŒåŒ…æ‹¬å‰ç«¯ç•Œé¢å’Œåç«¯ API æ¶æ„ã€‚

**âš ï¸ é‡è¦æç¤º**ï¼šå½“å‰ä¸ºå ä½ç¬¦å®ç°ï¼Œå±•ç¤ºäº†å®Œæ•´çš„ UI å’Œ API ç»“æ„ï¼Œä½†**æœªæ¥å…¥çœŸå®çš„åŒºå—é“¾**ã€‚

---

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. æ•°æ®åº“ç»“æ„ âœ“

**ä¿®æ”¹çš„è¡¨ï¼š**
- `users` - æ·»åŠ é’±åŒ…åœ°å€ç›¸å…³å­—æ®µï¼ˆwalletAddress, walletConnectedAt, walletTypeï¼‰
- `orders` - æ·»åŠ  NFT ç›¸å…³å­—æ®µï¼ˆnftStatus, nftTokenId, nftTransactionHash, nftMintedAtï¼‰
- `events` - æ·»åŠ  NFT å¯ç”¨å¼€å…³ï¼ˆnftEnabled, nftContractAddress, nftMetadataUriï¼‰

**æ–°å¢çš„è¡¨ï¼š**
- `nft_mint_queue` - NFT é“¸é€ é˜Ÿåˆ—ï¼ˆç”¨äºå¼‚æ­¥å¤„ç†ï¼‰
- `nft_transactions` - NFT äº¤æ˜“è®°å½•
- `user_nft_assets` - ç”¨æˆ·çš„ NFT èµ„äº§
- `nft_config` - NFT ç³»ç»Ÿé…ç½®

**è¿ç§»æ–‡ä»¶ï¼š** Prisma schema å·²æ›´æ–°å¹¶æˆåŠŸæ¨é€åˆ°æ•°æ®åº“

---

### 2. åç«¯ API âœ“

**å·²åˆ›å»ºçš„ API è·¯ç”±ï¼š**

#### é’±åŒ…ç®¡ç†
- `POST /api/nft/wallet/bind` - ç»‘å®šé’±åŒ…åœ°å€
- `GET /api/nft/wallet/status` - æŸ¥è¯¢é’±åŒ…ç»‘å®šçŠ¶æ€

#### NFT é“¸é€ 
- `POST /api/nft/mint/request` - è¯·æ±‚é“¸é€  NFT
- `GET /api/nft/mint/status/[orderId]` - æŸ¥è¯¢é“¸é€ çŠ¶æ€

#### NFT èµ„äº§
- `GET /api/nft/assets/my` - è·å–ç”¨æˆ·çš„æ‰€æœ‰ NFT

**å ä½ç¬¦è¯´æ˜ï¼š**
- âœ… API è·¯ç”±å®Œæ•´å®ç°
- âœ… æ•°æ®åº“æ“ä½œæ­£å¸¸
- â³ ç­¾åéªŒè¯ï¼šä½¿ç”¨å ä½ç¬¦ï¼ˆæœªçœŸå®éªŒè¯ç­¾åï¼‰
- â³ NFT é“¸é€ ï¼šæ¨¡æ‹Ÿé“¸é€ ï¼ˆ5ç§’åè‡ªåŠ¨å®Œæˆï¼Œæœªè°ƒç”¨åŒºå—é“¾ï¼‰
- â³ Token IDï¼šéšæœºç”Ÿæˆï¼ˆæœªä»æ™ºèƒ½åˆçº¦è·å–ï¼‰

---

### 3. å‰ç«¯ç»„ä»¶ âœ“

**å·²åˆ›å»ºçš„ç»„ä»¶ï¼š** `components/NFTComponents.tsx`

åŒ…å«ä»¥ä¸‹å­ç»„ä»¶ï¼š

1. **WalletConnectButton** - é’±åŒ…è¿æ¥æŒ‰é’®
   - æ£€æµ‹ MetaMask å®‰è£…
   - è¯·æ±‚è¿æ¥é’±åŒ…
   - æ˜¾ç¤ºè¿æ¥çŠ¶æ€

2. **MintNFTButton** - NFT é“¸é€ æŒ‰é’®
   - æäº¤é“¸é€ è¯·æ±‚
   - æ˜¾ç¤ºé“¸é€ çŠ¶æ€ï¼ˆé“¸é€ ä¸­/å·²å®Œæˆï¼‰
   - å®æ—¶è½®è¯¢çŠ¶æ€æ›´æ–°

3. **MyNFTList** - NFT åˆ—è¡¨å±•ç¤º
   - ç½‘æ ¼å¸ƒå±€å±•ç¤º
   - æ˜¾ç¤º NFT è¯¦ç»†ä¿¡æ¯
   - OpenSea å’ŒåŒºå—æµè§ˆå™¨é“¾æ¥

4. **OrderNFTSection** - è®¢å•è¯¦æƒ…é¡µ NFT åŒºåŸŸ
   - ç»„åˆä¸Šè¿°ç»„ä»¶
   - æ˜¾ç¤º NFT è¯´æ˜

---

### 4. é¡µé¢é›†æˆ âœ“

**å·²ä¿®æ”¹/åˆ›å»ºçš„é¡µé¢ï¼š**

1. **è®¢å•è¯¦æƒ…é¡µ** (`app/order/[id]/ui/OrderClient.tsx`)
   - âœ… å¼•å…¥ OrderNFTSection ç»„ä»¶
   - âœ… åœ¨å·²æ”¯ä»˜è®¢å•ä¸­æ˜¾ç¤º NFT åŠŸèƒ½

2. **æˆ‘çš„ NFT é¡µé¢** (`app/account/nfts/page.tsx`)
   - âœ… æ–°å»ºç‹¬ç«‹çš„ NFT æ”¶è—é¡µé¢
   - âœ… æ˜¾ç¤ºç”¨æˆ·çš„æ‰€æœ‰ NFT
   - âœ… é’±åŒ…è¿æ¥åŠŸèƒ½
   - âœ… NFT è¯´æ˜å¡ç‰‡

3. **å¯¼èˆªæ ** (`components/Navbar.tsx` & `components/Sidebar.tsx`)
   - âœ… æ·»åŠ "æˆ‘çš„ NFT"å¯¼èˆªå…¥å£

---

## ğŸš§ å ä½ç¬¦è¯´æ˜

### å½“å‰æ¨¡æ‹Ÿçš„åŠŸèƒ½

1. **é’±åŒ…è¿æ¥**
   - âœ… å‰ç«¯å¯ä»¥è°ƒç”¨ MetaMask
   - â³ åç«¯**ä¸éªŒè¯**ç­¾åï¼ˆå ä½ç¬¦ï¼‰
   - â³ ç›´æ¥ä¿å­˜é’±åŒ…åœ°å€åˆ°æ•°æ®åº“

2. **NFT é“¸é€ **
   - âœ… å‰ç«¯æäº¤é“¸é€ è¯·æ±‚
   - â³ åç«¯**5ç§’åè‡ªåŠ¨å®Œæˆ**ï¼ˆå ä½ç¬¦ï¼‰
   - â³ **ä¸è°ƒç”¨**çœŸå®çš„æ™ºèƒ½åˆçº¦
   - â³ Token ID ä¸ºéšæœºç”Ÿæˆ

3. **NFT å±•ç¤º**
   - âœ… ä»æ•°æ®åº“è¯»å– NFT è®°å½•
   - â³ OpenSea é“¾æ¥æŒ‡å‘æµ‹è¯•ç½‘ï¼ˆå ä½ç¬¦ï¼‰
   - â³ å›¾ç‰‡ä½¿ç”¨æ´»åŠ¨å°é¢ï¼ˆå ä½ç¬¦ï¼‰

---

## ğŸ” ç”¨æˆ·è®¤è¯å ä½ç¬¦

**å½“å‰å®ç°ï¼š**
- ä½¿ç”¨è¯·æ±‚å¤´ `x-user-id: "test-user-id"` æ¨¡æ‹Ÿç”¨æˆ·è®¤è¯
- å‰ç«¯ç¡¬ç¼–ç ä½¿ç”¨ `"test-user-id"`

**åç»­éœ€è¦ï¼š**
- é›†æˆçœŸå®çš„ session/JWT è®¤è¯
- ä» localStorage çš„ token ä¸­è·å–ç”¨æˆ·ID
- åœ¨ API ä¸­éªŒè¯ç”¨æˆ·èº«ä»½

---

## ğŸ“‹ ä¸‹ä¸€æ­¥ï¼šæ¥å…¥çœŸå®åŒºå—é“¾

### éœ€è¦å®Œæˆçš„ä»»åŠ¡

#### 1. æ™ºèƒ½åˆçº¦éƒ¨ç½²
- [ ] ç¼–å†™/ä½¿ç”¨ ERC-721 NFT åˆçº¦
- [ ] éƒ¨ç½²åˆ°æµ‹è¯•ç½‘ï¼ˆPolygon Mumbaiï¼‰
- [ ] éƒ¨ç½²åˆ°ä¸»ç½‘ï¼ˆPolygonï¼‰
- [ ] éªŒè¯åˆçº¦

#### 2. åç«¯åŒºå—é“¾é›†æˆ
- [ ] å®‰è£… ethers.js
- [ ] é…ç½® RPC èŠ‚ç‚¹ï¼ˆAlchemy/Infuraï¼‰
- [ ] å®ç°ç­¾åéªŒè¯é€»è¾‘
- [ ] å®ç°çœŸå®çš„ NFT é“¸é€ è°ƒç”¨
- [ ] ç›‘å¬åŒºå—é“¾äº‹ä»¶
- [ ] åŒæ­¥é“¾ä¸Šæ•°æ®

#### 3. å…ƒæ•°æ®ç®¡ç†
- [ ] æ³¨å†Œ Pinata/IPFS è´¦å·
- [ ] ä¸Šä¼  NFT å›¾ç‰‡åˆ° IPFS
- [ ] ç”Ÿæˆ NFT metadata JSON
- [ ] ä¸Šä¼  metadata åˆ° IPFS

#### 4. å‰ç«¯å®Œå–„
- [ ] æ·»åŠ ç½‘ç»œåˆ‡æ¢åŠŸèƒ½ï¼ˆä¸»ç½‘/æµ‹è¯•ç½‘ï¼‰
- [ ] æ·»åŠ äº¤æ˜“ç¡®è®¤å¼¹çª—
- [ ] æ˜¾ç¤ºçœŸå®çš„ Gas è´¹ç”¨
- [ ] é”™è¯¯å¤„ç†ä¼˜åŒ–

#### 5. é…ç½®ç®¡ç†
- [ ] åˆ›å»º .env.nft æ–‡ä»¶
- [ ] é…ç½® RPC URL
- [ ] é…ç½®åˆçº¦åœ°å€
- [ ] é…ç½® IPFS å¯†é’¥

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### å½“å‰å¯ä»¥æµ‹è¯•çš„åŠŸèƒ½

#### 1. æµ‹è¯•é’±åŒ…è¿æ¥

1. è®¿é—®ä»»æ„å·²æ”¯ä»˜çš„è®¢å•è¯¦æƒ…é¡µ
2. ç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®
3. âš ï¸ éœ€è¦å®‰è£… MetaMask æµè§ˆå™¨æ’ä»¶
4. åœ¨ MetaMask ä¸­ç¡®è®¤è¿æ¥
5. ç­¾åæ¶ˆæ¯
6. æŸ¥çœ‹è¿æ¥æˆåŠŸçŠ¶æ€

#### 2. æµ‹è¯• NFT é“¸é€ 

1. ç¡®ä¿å·²è¿æ¥é’±åŒ…
2. åœ¨è®¢å•è¯¦æƒ…é¡µç‚¹å‡»"ğŸ¨ è½¬ä¸ºNFTï¼ˆå…è´¹ï¼‰"
3. ç­‰å¾… 5 ç§’ï¼ˆæ¨¡æ‹Ÿé“¸é€ ï¼‰
4. é¡µé¢è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤º"NFTå·²é“¸é€ "

#### 3. æµ‹è¯• NFT åˆ—è¡¨

1. è®¿é—® `/account/nfts` é¡µé¢
2. æŸ¥çœ‹å·²é“¸é€ çš„ NFT
3. ç‚¹å‡»"OpenSeaæŸ¥çœ‹"ï¼ˆæŒ‡å‘æµ‹è¯•ç½‘ï¼‰
4. ç‚¹å‡»"åŒºå—æµè§ˆå™¨"ï¼ˆæŒ‡å‘æµ‹è¯•ç½‘ï¼‰

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
piaoyuzhou/
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma                    # âœ… å·²æ›´æ–°ï¼ˆæ–°å¢ NFT è¡¨ï¼‰
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ nft/
â”‚   â”‚       â”œâ”€â”€ wallet/
â”‚   â”‚       â”‚   â”œâ”€â”€ status/route.ts      # âœ… é’±åŒ…çŠ¶æ€æŸ¥è¯¢
â”‚   â”‚       â”‚   â””â”€â”€ bind/route.ts        # âœ… é’±åŒ…ç»‘å®š
â”‚   â”‚       â”œâ”€â”€ mint/
â”‚   â”‚       â”‚   â”œâ”€â”€ request/route.ts     # âœ… é“¸é€ è¯·æ±‚
â”‚   â”‚       â”‚   â””â”€â”€ status/[orderId]/route.ts  # âœ… é“¸é€ çŠ¶æ€
â”‚   â”‚       â””â”€â”€ assets/
â”‚   â”‚           â””â”€â”€ my/route.ts          # âœ… æˆ‘çš„NFT
â”‚   â”œâ”€â”€ order/[id]/ui/
â”‚   â”‚   â””â”€â”€ OrderClient.tsx              # âœ… å·²é›†æˆ NFT ç»„ä»¶
â”‚   â””â”€â”€ account/
â”‚       â””â”€â”€ nfts/
â”‚           â”œâ”€â”€ page.tsx                 # âœ… æˆ‘çš„NFTé¡µé¢
â”‚           â””â”€â”€ ui/NFTsClient.tsx        # âœ… NFTå®¢æˆ·ç«¯ç»„ä»¶
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ NFTComponents.tsx                # âœ… NFT ç»„ä»¶åº“
â”‚   â”œâ”€â”€ Navbar.tsx                       # âœ… å·²æ·»åŠ  NFT å…¥å£
â”‚   â””â”€â”€ Sidebar.tsx                      # âœ… å·²æ·»åŠ  NFT å…¥å£
â””â”€â”€ docs/
    â””â”€â”€ NFTåŠŸèƒ½å®ç°è¯´æ˜.md               # ğŸ“„ æœ¬æ–‡æ¡£
```

---

## ğŸ¯ æŠ€æœ¯æ ˆ

### å‰ç«¯
- âœ… Next.js 14 (App Router)
- âœ… TypeScript
- âœ… Tailwind CSS
- â³ ethers.jsï¼ˆå‰ç«¯å·²è°ƒç”¨ window.ethereumï¼Œåç»­å¯æ‰©å±•ï¼‰

### åç«¯
- âœ… Next.js API Routes
- âœ… Prisma ORM
- âœ… PostgreSQL
- â³ ethers.jsï¼ˆéœ€è¦å®‰è£…ï¼‰

### åŒºå—é“¾ï¼ˆå¾…æ¥å…¥ï¼‰
- â³ Polygon (æµ‹è¯•ç½‘/ä¸»ç½‘)
- â³ Solidity æ™ºèƒ½åˆçº¦
- â³ IPFS å­˜å‚¨

---

## ğŸ’¡ å…³é”®ä»£ç ä½ç½®

### å‰ç«¯è°ƒç”¨ MetaMask

```typescript
// components/NFTComponents.tsx:40-60
const accounts = await window.ethereum.request({
  method: "eth_requestAccounts",
});
const address = accounts[0];
const signature = await window.ethereum.request({
  method: "personal_sign",
  params: [message, address],
});
```

### åç«¯å ä½ç¬¦é“¸é€ 

```typescript
// app/api/nft/mint/request/route.ts:95-130
// ğŸš§ å ä½ç¬¦ï¼šæ¨¡æ‹Ÿå¼‚æ­¥é“¸é€ è¿‡ç¨‹
setTimeout(async () => {
  const mockTokenId = Math.floor(Math.random() * 10000) + 1;
  const mockTxHash = `0x${Math.random().toString(16)...}`;
  // æ›´æ–°æ•°æ®åº“...
}, 5000);
```

### æ•°æ®åº“ Schema

```prisma
// prisma/schema.prisma:513-602
model NFTMintQueue { ... }
model NFTTransaction { ... }
model UserNFTAsset { ... }
model NFTConfig { ... }
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§**
   - âŒ å½“å‰**æœªéªŒè¯**ç­¾å
   - âŒ è¯·å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
   - âœ… åç»­éœ€è¦æ·»åŠ ç­¾åéªŒè¯

2. **æ€§èƒ½**
   - âœ… ä½¿ç”¨å¼‚æ­¥é˜Ÿåˆ—å¤„ç†é“¸é€ 
   - âœ… å®šæ—¶è½®è¯¢çŠ¶æ€æ›´æ–°
   - â³ åç»­å¯ä»¥ä½¿ç”¨ WebSocket å®æ—¶æ¨é€

3. **ç”¨æˆ·ä½“éªŒ**
   - âœ… åŠ è½½çŠ¶æ€æç¤º
   - âœ… é”™è¯¯å¤„ç†
   - â³ åç»­å¯ä»¥æ·»åŠ æ›´è¯¦ç»†çš„è¿›åº¦å±•ç¤º

---

## ğŸ‰ æ€»ç»“

### âœ… å·²å®Œæˆ

- [x] æ•°æ®åº“ç»“æ„è®¾è®¡å’Œè¿ç§»
- [x] å®Œæ•´çš„åç«¯ API æ¶æ„ï¼ˆå ä½ç¬¦å®ç°ï¼‰
- [x] å®Œæ•´çš„å‰ç«¯ç»„ä»¶å’Œé¡µé¢
- [x] è®¢å•è¯¦æƒ…é¡µé›†æˆ
- [x] ç‹¬ç«‹çš„ NFT æ”¶è—é¡µé¢
- [x] å¯¼èˆªæ å…¥å£

### â³ ä¸‹ä¸€æ­¥ï¼ˆçœŸå®åŒºå—é“¾é›†æˆï¼‰

- [ ] éƒ¨ç½²æ™ºèƒ½åˆçº¦
- [ ] æ¥å…¥ RPC èŠ‚ç‚¹
- [ ] å®ç°çœŸå®çš„ç­¾åéªŒè¯
- [ ] å®ç°çœŸå®çš„ NFT é“¸é€ 
- [ ] é…ç½® IPFS å­˜å‚¨
- [ ] OpenSea é›†æˆ

---

## ğŸ“š å‚è€ƒèµ„æ–™

**å‚è€ƒæ–‡ä»¶ï¼š**
- `nft-migration-kit/README.md` - NFT åŠŸèƒ½å®Œæ•´æŒ‡å—
- `nft-migration-kit/docs/INSTALLATION.md` - å®‰è£…å’Œé›†æˆæ–‡æ¡£
- `nft-migration-kit/frontend/nft-components.jsx` - å‰ç«¯ç»„ä»¶å‚è€ƒ
- `nft-migration-kit/backend/nft-routes.js` - åç«¯ API å‚è€ƒ

**åŒºå—é“¾æ–‡æ¡£ï¼š**
- [Polygon å®˜æ–¹æ–‡æ¡£](https://docs.polygon.technology/)
- [ethers.js æ–‡æ¡£](https://docs.ethers.org/)
- [OpenZeppelin åˆçº¦](https://docs.openzeppelin.com/)
- [IPFS æ–‡æ¡£](https://docs.ipfs.tech/)

---

**ğŸ¨ ç¥æ‚¨çš„ NFT é¡¹ç›®æˆåŠŸï¼**

*å®ç°æ—¶é—´ï¼š2025-11-02*
*ç‰ˆæœ¬ï¼šv1.0 (å ä½ç¬¦å®ç°)*
