《票次元》项目文档

## 一、项目概述（Project Overview）

### 基本信息
- **项目名称**：票次元 (Piaociyuan)
- **项目类型**：现代化票务平台（Web + Mobile App）
- **架构模式**：Turborepo Monorepo
- **当前状态**：✅ MVP 已完成，功能持续迭代中

### 一句话简介
票次元是一个面向年轻群体的全栈票务平台，结合高并发抢票、NFT数字藏品、社交互动等特性，为用户提供从购票到收藏的完整体验。

### 愿景
让追星体验不止于一场演出，让每张票都成为独一无二的数字回忆。

### 技术栈
- **架构**：Turborepo Monorepo
- **前端**：Next.js 16 (App Router) + React 19 + Tailwind CSS 4
- **后端**：Next.js API Routes
- **数据库**：PostgreSQL 18 + Prisma ORM 6.18
- **认证**：JWT (JSON Web Token)
- **移动端**：React Native + Expo SDK 54
- **实时通讯**：Socket.io
- **高并发优化**：FOR UPDATE SKIP LOCKED 悲观锁机制

## 二、目标客户（Target Audience）

### 核心人群
18–35岁，包括大学生、年轻上班族、演出爱好者

### 兴趣爱好
演唱会、音乐节、展览、艺术展、体育赛事、收集纪念周边、线上社交

### 消费习惯
- 偏好线上购票
- 注重价格透明与交易安全
- 喜欢个性化体验与社交分享
- 对数字收藏品有兴趣

### 用户痛点
1. **抢票难**：热门活动秒光，黄牛横行
2. **体验差**：传统平台交互复杂，缺乏社交属性
3. **无纪念**：演出结束后缺少情感延伸
4. **不安全**：票务真假难辨，交易风险高

## 三、核心价值主张（Unique Value Proposition）

### 解决的问题
为用户提供安全、高效、有情感温度的票务体验，并通过数字藏品延续演出回忆。

### 我们的解决方案
构建一个技术驱动的现代化票务平台：
- **高并发抢票**：智能锁票机制，支持千人级并发
- **NFT数字藏品**：购票后自动获得专属NFT纪念品
- **社交互动**：帖子、评论、点赞、关注，打造粉丝社区
- **身份认证**：艺人、主办方、官方机构认证体系
- **移动优先**：Web + Mobile App 双端体验

### 与竞品的差异化
- ✅ **技术领先**：采用最新技术栈（Next.js 16, React 19, PostgreSQL 18）
- ✅ **NFT创新**：将门票与数字藏品结合，支持3D/AR展示
- ✅ **高并发优化**：借鉴大麦网机制，自动分配+手动选座智能切换
- ✅ **社交属性**：不只是票务平台，更是粉丝社区
- ✅ **开源友好**：Monorepo架构，代码结构清晰，易于二次开发

## 四、核心功能（Core Features）

### ✅ 已完成功能

#### 1. 票务系统（核心）
- **活动管理**
  - 多类型活动支持：演唱会、音乐节、展览、音乐会、演出、体育赛事
  - 活动分类、搜索、筛选
  - 售票状态控制：未开售、售票中、暂停、售罄、已结束
  - 开售/停售时间自动管理
- **购票流程**
  - 智能锁票机制（15分钟超时释放）
  - 自动分配座位 + 手动选座混合模式
  - 高并发抢票支持（千人级并发测试通过）
  - 实名验证
  - 模拟支付（可扩展真实支付）
- **订单管理**
  - 订单创建、查询、退款
  - 票务状态追踪（待支付、已支付、已使用、已退款）
  - 电子票码生成
  - 验票功能

#### 2. NFT数字藏品系统
- **NFT类型**
  - 购票奖励NFT（ticket_reward）
  - 独立售卖NFT（standalone）
  - 空投NFT（airdrop）
- **NFT分类**
  - 徽章（badge）
  - 票根（ticket_stub）
  - 海报（poster）
  - 证书（certificate）
  - 艺术品（art）
- **3D/AR支持**
  - 3D模型展示
  - AR互动（预留接口）
  - 动画效果
- **NFT功能**
  - 铸造队列管理
  - 链上同步
  - 转移记录
  - 稀有度系统（common, rare, epic, legendary）
  - 供应量控制

#### 3. 社交系统
- **帖子功能**（回声 Encore）
  - 发布图文帖子（支持多图）
  - 关联活动标签
  - 地理位置标注
  - 浏览量统计
- **互动功能**
  - 点赞、评论
  - 收藏帖子
  - 举报机制
  - 帖子可见性控制
- **私聊系统**
  - 一对一私信
  - 消息已读状态
  - 未读消息统计
  - 实时消息（Socket.io）

#### 4. 用户系统
- **认证方式**
  - 手机号 + 验证码注册/登录
  - 邮箱注册/登录
  - 密码登录
  - 第三方登录（预留微信、QQ接口）
- **安全机制**
  - JWT双Token机制（Access + Refresh）
  - 密码加密存储（bcrypt）
  - 登录日志记录
  - 会话管理
- **个人中心**
  - 个人信息编辑（昵称、头像、简介、封面）
  - 钱包绑定（MetaMask等）
  - 我的订单
  - 我的NFT收藏
  - 我的帖子
  - 我的收藏

#### 5. 关注系统
- **用户关注**
  - 关注/取关用户
  - 粉丝列表
  - 关注列表
  - 关注数统计
- **活动关注**
  - 关注感兴趣的活动
  - 开售提醒（预留）

#### 6. 身份认证系统
- **认证类型**
  - 明星/艺人认证
  - 主办方认证
  - 官方机构认证
- **认证流程**
  - 在线申请提交
  - 上传证明材料
  - 管理员审核
  - 认证徽章展示

#### 7. 管理后台
- **用户管理**
  - 用户列表查看
  - 角色权限管理（user/admin）
  - 封禁/解封用户
- **活动管理**
  - 活动创建/编辑/删除
  - 票档设置
  - 售票状态控制
- **内容审核**
  - 帖子举报处理
  - 帖子删除/隐藏
- **认证审核**
  - 认证申请审批
  - 认证信息管理
- **NFT管理**
  - NFT创建/编辑
  - 供应量控制
  - 铸造状态监控

#### 8. 移动应用（进行中 🚧）
- ✅ 用户认证（登录、注册、验证码）
- ✅ 底部导航（首页、活动、门票、我的）
- ✅ 安全存储（Expo SecureStore）
- ✅ 全局状态管理（React Context）
- ✅ 活动列表和搜索
- ✅ 活动详情和票档选择
- ✅ 订单列表和管理
- ✅ 门票展示
- 🚧 支付集成
- 🚧 NFT数字藏品
- 🚧 社交功能
- 🚧 扫码验票
- 🚧 推送通知

### 🚧 规划中功能

#### 会员体系（第二阶段）
- 积分系统
- 用户等级
- 购票优先权
- 专属徽章和权益

#### 数据推荐系统（第三阶段）
- 基于关注的活动推荐
- NFT推荐
- 个性化内容推送

#### 支付系统（待接入）
- 微信支付
- 支付宝
- 银联支付

#### 消息通知（待完善）
- 站内消息
- 邮件通知
- 短信通知
- 推送通知（移动端）

## 五、品牌与情感定位（Brand & Emotion）

### 品牌风格
年轻、活力、现代、专业、有温度

### 品牌口号
你的每一场追星，都值得被收藏。

### 情感价值
- **陪伴**：不只是购票工具，更是粉丝的情感寄托
- **纪念**：将每次演出化作永久的数字回忆
- **热爱**：为热爱的人和事全力以赴
- **真实**：真票、真人、真情感
- **安全**：技术保障，让每一次交易都安心

### 视觉设计
- **色彩**：紫色主题 + 现代渐变
- **风格**：扁平化设计，简洁现代
- **交互**：流畅动效，细节考究
- **响应式**：完美适配各种设备

## 六、商业模式（Business Model）

### 收入来源

#### 1. 票务服务费（主要）
- 从主办方收取 10-20% 服务费
- 或向用户收取小额服务费

#### 2. NFT销售（创新）
- 独立NFT藏品销售
- 稀有度定价策略
- 盲盒玩法

#### 3. 会员订阅（规划中）
- 月度/年度会员
- 优先购票权
- 专属NFT空投
- 无广告体验

#### 4. 广告与合作（辅助）
- 活动推广位
- 品牌联名NFT
- 艺人工作室合作

#### 5. 二级市场手续费（未来）
- NFT转让手续费（5-10%）
- 票务转让手续费

### 成本结构
- 服务器与带宽成本
- 数据库维护
- 区块链Gas费（NFT铸造）
- 开发与运营人员
- 营销推广费用

## 七、市场推广（Marketing & Growth）

### 已实施策略
- ✅ 技术博客：分享开发经验，吸引开发者关注
- ✅ GitHub开源：Monorepo架构展示
- ✅ 文档完善：详细的技术文档和使用指南

### 待实施策略

#### 校园推广
- 在高校举办线下活动
- 与学生社团合作
- 校园大使计划

#### KOL合作
- 邀请追星博主体验
- 微博、小红书、B站推广
- 明星工作室合作

#### 社区运营
- 官方账号运营
- 用户分享激励
- 积分奖励体系

#### 技术营销
- 开源项目推广
- 技术分享会
- 开发者社区建设

## 八、项目进展与里程碑（Roadmap）

### ✅ 阶段 0：Monorepo架构迁移（已完成）
**时间**：2025年11月
- ✅ Turborepo架构搭建
- ✅ Web应用迁移
- ✅ 共享包（shared）创建
- ✅ 构建和部署流程优化

### ✅ 阶段 1：MVP开发（已完成）
**时间**：2025年11月初
**目标**：完成核心票务功能

完成内容：
- ✅ 用户系统（注册/登录/认证）
- ✅ 活动管理（创建/浏览/搜索）
- ✅ 票务系统（购票/订单/退款）
- ✅ NFT系统（铸造/展示/管理）
- ✅ 高并发优化（智能锁票机制）
- ✅ 管理后台

**测试结果**：
- 支持千人级并发抢票
- 0% 超卖率
- 平均响应时间 1.84ms

### ✅ 阶段 2：社交功能（已完成）
**时间**：2025年11月中旬
**目标**：打造粉丝社区

完成内容：
- ✅ 帖子系统（发布/浏览/互动）
- ✅ 评论功能
- ✅ 点赞和收藏
- ✅ 私聊系统
- ✅ 用户关注
- ✅ 活动关注
- ✅ 身份认证申请

### 🚧 阶段 3：移动应用开发（进行中）
**时间**：2025年11月
**目标**：推出移动端App

进度：
- ✅ React Native + Expo 项目搭建
- ✅ 用户认证模块
- ✅ 底部导航框架
- ✅ 活动列表和详情
- ✅ 订单管理
- 🚧 支付集成
- 🚧 NFT功能
- 🚧 社交模块
- 🚧 扫码验票

预计完成时间：2025年12月

### 📅 阶段 4：支付与会员（规划中）
**时间**：2026年1-3月
**目标**：完善商业化能力

计划内容：
- 接入真实支付（微信、支付宝）
- 会员等级体系
- 积分系统
- VIP专属权益
- 优先购票机制

### 📅 阶段 5：智能推荐（规划中）
**时间**：2026年4-6月
**目标**：提升用户体验

计划内容：
- 基于关注的活动推荐
- 个性化NFT推荐
- 智能消息推送
- 数据分析看板

### 📅 阶段 6：生态扩展（规划中）
**时间**：2026年下半年
**目标**：打造完整生态

计划内容：
- NFT二级市场
- 跨链支持
- API开放平台
- 第三方开发者生态

## 九、技术架构（Technical Architecture）

### 项目结构
```
piaoyuzhou/                    # Monorepo 根目录
├── apps/                      # 应用目录
│   ├── web/                   # Web 应用（Next.js）
│   └── mobile/                # 移动应用（React Native + Expo）
├── packages/                  # 共享包目录
│   └── shared/                # 共享代码包（类型、常量）
└── docs/                      # 项目文档
```

### 核心技术选型理由

#### 前端
- **Next.js 16**：最新的App Router，服务端渲染，SEO友好
- **React 19**：最新特性，性能优化
- **Tailwind CSS 4**：快速开发，样式一致性

#### 后端
- **Next.js API Routes**：前后端一体化，部署简单
- **Prisma ORM**：类型安全，迁移管理便捷

#### 数据库
- **PostgreSQL 18**：企业级可靠性，支持复杂查询
- **FOR UPDATE SKIP LOCKED**：高并发场景最佳实践

#### 移动端
- **React Native**：代码复用，跨平台
- **Expo**：快速开发，开箱即用

### 高并发设计

#### 智能抢票机制
1. **开售初期**：强制自动分配座位（悲观锁）
2. **开售后期**：支持手动选座（乐观锁）
3. **自动切换**：根据时间和并发度智能调整

#### 数据库优化
- 使用 `FOR UPDATE SKIP LOCKED` 避免锁等待
- 索引优化，查询性能提升
- 连接池管理

### 安全设计
- JWT双Token机制（防止Token劫持）
- 密码bcrypt加密
- SQL注入防护（Prisma ORM）
- XSS防护
- CSRF防护
- 敏感数据加密存储

## 十、数据库设计亮点

### 核心表结构
- **users**：用户信息、钱包、认证状态
- **events**：活动信息、售票状态
- **tiers**：票档配置
- **tickets**：票务记录、NFT绑定
- **orders**：订单管理
- **nfts**：NFT配置、3D/AR
- **user_nfts**：用户NFT资产
- **posts**：社交帖子
- **messages**：私聊消息
- **verification_requests**：认证申请

### 设计特点
- 完整的索引策略
- 级联删除配置
- 状态机设计
- 审计字段（createdAt, updatedAt）

## 十一、部署与运维

### 开发环境
- Node.js 18+
- PostgreSQL 18
- npm workspaces

### 生产部署（推荐）
- **前端**：Vercel（自动CI/CD）
- **数据库**：Supabase / Railway / 自建PostgreSQL
- **文件存储**：Cloudinary / AWS S3
- **CDN**：Vercel Edge Network

### 监控与日志
- 登录日志记录
- 订单状态追踪
- NFT铸造监控
- 错误日志收集（待接入Sentry）

## 十二、团队与联系

### 项目状态
- **当前版本**：v1.0.0（MVP）
- **开发状态**：🟢 活跃开发中
- **代码仓库**：GitHub（Private）
- **License**：MIT

### 技术栈总结
一个采用最新技术栈的全栈项目，涵盖Web、Mobile、NFT、高并发等多个技术领域，是学习现代Web开发的优秀案例。

---

**最后更新**：2025年11月
**文档版本**：v2.0