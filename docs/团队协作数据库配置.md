# å›¢é˜Ÿåä½œæ•°æ®åº“é…ç½®æŒ‡å—

## æ–¹æ¡ˆä¸€ï¼šå…±äº«è¿œç¨‹æ•°æ®åº“ï¼ˆæ¨èï¼‰

é€‚ç”¨äºå›¢é˜Ÿæˆå‘˜éœ€è¦è®¿é—®ç›¸åŒæ•°æ®çš„åœºæ™¯ã€‚

### æ­¥éª¤ï¼š

#### 1. è®¾ç½®è¿œç¨‹ PostgreSQL æ•°æ®åº“

æœ‰ä»¥ä¸‹å‡ ç§é€‰æ‹©ï¼š

**é€‰é¡¹ Aï¼šä½¿ç”¨äº‘æ•°æ®åº“æœåŠ¡ï¼ˆæœ€ç®€å•ï¼‰**
- [Supabase](https://supabase.com/)ï¼šå…è´¹å¥—é¤ï¼Œ500MB å­˜å‚¨
- [Neon](https://neon.tech/)ï¼šå…è´¹å¥—é¤ï¼ŒServerless PostgreSQL
- [Railway](https://railway.app/)ï¼šå…è´¹å¥—é¤
- [ElephantSQL](https://www.elephantsql.com/)ï¼šå…è´¹å¥—é¤

**é€‰é¡¹ Bï¼šä½¿ç”¨å…¬å¸æœåŠ¡å™¨**
- åœ¨å…¬å¸æœåŠ¡å™¨ä¸Šå®‰è£… PostgreSQL
- é…ç½®é˜²ç«å¢™å…è®¸å›¢é˜Ÿæˆå‘˜è®¿é—®

#### 2. è·å–æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

äº‘æœåŠ¡ä¼šæä¾›ç±»ä¼¼è¿™æ ·çš„è¿æ¥å­—ç¬¦ä¸²ï¼š
```
postgresql://ç”¨æˆ·å:å¯†ç @ä¸»æœºåœ°å€:ç«¯å£/æ•°æ®åº“å?sslmode=require
```

#### 3. å›¢é˜Ÿæˆå‘˜é…ç½®

æ¯ä¸ªå›¢é˜Ÿæˆå‘˜åœ¨è‡ªå·±çš„ `.env` æ–‡ä»¶ä¸­ä½¿ç”¨**ç›¸åŒçš„** `DATABASE_URL`ï¼š

```env
# .envï¼ˆæ‰€æœ‰å›¢é˜Ÿæˆå‘˜ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“ï¼‰
DATABASE_URL="postgresql://user:pass@your-cloud-db.com:5432/piaociyuan?sslmode=require"

# JWT å’ŒåŠ å¯†å¯†é’¥å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
JWT_SECRET="å›¢é˜Ÿç»Ÿä¸€çš„å¯†é’¥"
ENCRYPTION_KEY="å›¢é˜Ÿç»Ÿä¸€çš„åŠ å¯†å¯†é’¥"
```

#### 4. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆåªéœ€ä¸€æ¬¡ï¼‰

**ç”±ä¸€ä½å›¢é˜Ÿæˆå‘˜æ‰§è¡Œï¼š**

```bash
# 1. è¿è¡Œæ•°æ®åº“è¿ç§»
npx prisma migrate deploy

# 2. å¡«å……ç§å­æ•°æ®
npm run db:seed
npm run db:create-tickets
```

#### 5. å…¶ä»–æˆå‘˜åŒæ­¥

å…¶ä»–å›¢é˜Ÿæˆå‘˜åªéœ€ï¼š

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repo-url>
cd piaoyuzhou

# 2. å®‰è£…ä¾èµ–
npm install

# 3. é…ç½® .envï¼ˆä½¿ç”¨å…±äº«çš„æ•°æ®åº“ URLï¼‰
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥å›¢é˜Ÿå…±äº«çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯

# 4. ç”Ÿæˆ Prisma Client
npx prisma generate

# 5. å¯åŠ¨é¡¹ç›®
npm run dev
```

### ä¼˜ç‚¹ï¼š
- âœ… æ‰€æœ‰äººçœ‹åˆ°çš„æ•°æ®ä¸€è‡´
- âœ… æ–¹ä¾¿æµ‹è¯•å¤šç”¨æˆ·äº¤äº’åŠŸèƒ½
- âœ… ä¸éœ€è¦æœ¬åœ°å®‰è£… PostgreSQL

### æ³¨æ„äº‹é¡¹ï¼š
- âš ï¸ å›¢é˜Ÿæˆå‘˜ä¼šç›¸äº’å½±å“æ•°æ®
- âš ï¸ éœ€è¦è‰¯å¥½çš„æ²Ÿé€šï¼ˆé¿å…åŒæ—¶ä¿®æ”¹åŒä¸€æ•°æ®ï¼‰
- âš ï¸ ä¸å»ºè®®åœ¨å…±äº«æ•°æ®åº“ä¸Šæµ‹è¯•æ•°æ®è¿ç§»

---

## æ–¹æ¡ˆäºŒï¼šæ¯äººç‹¬ç«‹æœ¬åœ°æ•°æ®åº“

é€‚ç”¨äºéœ€è¦ç‹¬ç«‹å¼€å‘ç¯å¢ƒçš„åœºæ™¯ã€‚

### æ­¥éª¤ï¼š

#### 1. æ¯ä½æˆå‘˜å®‰è£… PostgreSQL

```bash
# Windows
# ä¸‹è½½ï¼šhttps://www.postgresql.org/download/windows/

# Mac
brew install postgresql
brew services start postgresql

# Linux
sudo apt-get install postgresql
sudo systemctl start postgresql
```

#### 2. åˆ›å»ºæœ¬åœ°æ•°æ®åº“

```bash
# ä½¿ç”¨ psql å‘½ä»¤è¡Œ
psql -U postgres

# åœ¨ psql ä¸­æ‰§è¡Œï¼š
CREATE DATABASE piaociyuan;
\q
```

#### 3. é…ç½®æœ¬åœ° .env

æ¯ä½æˆå‘˜ä½¿ç”¨**è‡ªå·±çš„æœ¬åœ°æ•°æ®åº“**ï¼š

```env
# .envï¼ˆæ¯ä¸ªäººéƒ½ä¸åŒï¼‰
DATABASE_URL="postgresql://postgres:ä½ çš„å¯†ç @localhost:5432/piaociyuan?connection_limit=20&pool_timeout=10&connect_timeout=10"

# JWT å¯†é’¥ï¼ˆå¯ä»¥ç»Ÿä¸€ï¼Œä¹Ÿå¯ä»¥å„è‡ªç”Ÿæˆï¼‰
JWT_SECRET="ä½ è‡ªå·±ç”Ÿæˆçš„å¯†é’¥"
ENCRYPTION_KEY="ä½ è‡ªå·±ç”Ÿæˆçš„åŠ å¯†å¯†é’¥"
```

#### 4. åˆå§‹åŒ–æœ¬åœ°æ•°æ®åº“

**æ¯ä½æˆå‘˜éƒ½éœ€è¦æ‰§è¡Œï¼š**

```bash
# 1. è¿è¡Œè¿ç§»
npx prisma migrate dev

# 2. ç”Ÿæˆ Prisma Client
npx prisma generate

# 3. å¡«å……ç§å­æ•°æ®
npm run db:seed
npm run db:create-tickets

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### ä¼˜ç‚¹ï¼š
- âœ… æ¯ä¸ªäººç‹¬ç«‹å¼€å‘ï¼Œäº’ä¸å½±å“
- âœ… å¯ä»¥éšæ„æµ‹è¯•æ•°æ®åº“è¿ç§»
- âœ… ä¸ä¾èµ–ç½‘ç»œè¿æ¥

### ç¼ºç‚¹ï¼š
- âŒ éœ€è¦æœ¬åœ°å®‰è£… PostgreSQL
- âŒ æ•°æ®ä¸åŒæ­¥ï¼Œéš¾ä»¥æµ‹è¯•å¤šç”¨æˆ·åœºæ™¯

---

## æ–¹æ¡ˆä¸‰ï¼šæ··åˆæ–¹æ¡ˆï¼ˆå¼€å‘ + æµ‹è¯•ç¯å¢ƒï¼‰

æ¨èçš„æœ€ä½³å®è·µï¼š

### é…ç½®ä¸¤å¥—ç¯å¢ƒ

```env
# .env.localï¼ˆæœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œä¸æäº¤åˆ° Gitï¼‰
DATABASE_URL="postgresql://postgres:local_pass@localhost:5432/piaociyuan_dev"

# .env.testï¼ˆå›¢é˜Ÿå…±äº«çš„æµ‹è¯•ç¯å¢ƒï¼Œå¯æäº¤åˆ° Gitï¼‰
DATABASE_URL="postgresql://team_user:team_pass@shared-db.com:5432/piaociyuan_test"
```

### ä½¿ç”¨æ–¹å¼

```bash
# æœ¬åœ°å¼€å‘ï¼ˆé»˜è®¤ï¼‰
npm run dev

# ä½¿ç”¨æµ‹è¯•ç¯å¢ƒ
NODE_ENV=test npm run dev

# æˆ–ä½¿ç”¨ dotenv-cli
npm install -g dotenv-cli
dotenv -e .env.test -- npm run dev
```

---

## æ•°æ®åº“è¿ç§»æœ€ä½³å®è·µ

### è§„åˆ™ï¼š

1. **å¼€å‘æ–°åŠŸèƒ½æ—¶**ï¼š
   - åœ¨æœ¬åœ°æ•°æ®åº“ä¸Šåˆ›å»ºè¿ç§»
   - æµ‹è¯•è¿ç§»æ— è¯¯åæäº¤åˆ° Git

2. **å›¢é˜Ÿæˆå‘˜åŒæ­¥è¿ç§»**ï¼š
   ```bash
   git pull
   npx prisma migrate dev  # åº”ç”¨æ–°çš„è¿ç§»
   npx prisma generate      # é‡æ–°ç”Ÿæˆå®¢æˆ·ç«¯
   ```

3. **å…±äº«æ•°æ®åº“ç¯å¢ƒ**ï¼š
   - æŒ‡å®šä¸€ä½è´Ÿè´£äººç®¡ç†è¿ç§»
   - å…¶ä»–äººåªä½¿ç”¨ `npx prisma migrate deploy`ï¼ˆä¸åˆ›å»ºæ–°è¿ç§»ï¼‰

### ç¤ºä¾‹å·¥ä½œæµï¼š

```bash
# æˆå‘˜ Aï¼šåˆ›å»ºæ–°è¿ç§»
npx prisma migrate dev --name add_user_avatar
git add prisma/migrations
git commit -m "feat: add user avatar field"
git push

# æˆå‘˜ Bï¼šæ‹‰å–å¹¶åº”ç”¨è¿ç§»
git pull
npx prisma migrate dev  # è‡ªåŠ¨åº”ç”¨ A åˆ›å»ºçš„è¿ç§»
npx prisma generate
npm run dev
```

---

## æ¨èé…ç½®æ€»ç»“

### å°å›¢é˜Ÿï¼ˆ2-5äººï¼‰
âœ… **ä½¿ç”¨æ–¹æ¡ˆä¸€ï¼ˆå…±äº«è¿œç¨‹æ•°æ®åº“ï¼‰**
- ä½¿ç”¨ Supabase æˆ– Neon å…è´¹å¥—é¤
- æ‰€æœ‰æˆå‘˜å…±äº«ä¸€ä¸ªå¼€å‘æ•°æ®åº“
- ç®€å•å¿«é€Ÿï¼Œæ— éœ€æœ¬åœ°å®‰è£…

### ä¸­å¤§å›¢é˜Ÿï¼ˆ5+äººï¼‰
âœ… **ä½¿ç”¨æ–¹æ¡ˆä¸‰ï¼ˆæ··åˆæ–¹æ¡ˆï¼‰**
- æœ¬åœ°æ•°æ®åº“ç”¨äºæ—¥å¸¸å¼€å‘
- å…±äº«æµ‹è¯•æ•°æ®åº“ç”¨äºé›†æˆæµ‹è¯•
- ç”Ÿäº§æ•°æ®åº“ç‹¬ç«‹éƒ¨ç½²

### å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒé…ç½®

```env
# .env.developmentï¼ˆæœ¬åœ°å¼€å‘ï¼‰
DATABASE_URL="postgresql://localhost:5432/piaociyuan_dev"

# .env.testï¼ˆå›¢é˜Ÿæµ‹è¯•ç¯å¢ƒï¼‰
DATABASE_URL="postgresql://test-server.com:5432/piaociyuan_test"

# .env.productionï¼ˆç”Ÿäº§ç¯å¢ƒï¼Œåœ¨éƒ¨ç½²å¹³å°é…ç½®ï¼‰
DATABASE_URL="postgresql://prod-server.com:5432/piaociyuan"
```

---

## å¸¸è§é—®é¢˜

### Q: æ•°æ®åº“å¯†ç åº”è¯¥æäº¤åˆ° Git å—ï¼Ÿ

**ç­”ï¼šä¸åº”è¯¥ï¼**

- âŒ `.env` æ–‡ä»¶ï¼ˆåŒ…å«çœŸå®å¯†ç ï¼‰ä¸è¦æäº¤åˆ° Git
- âœ… `.env.example` æ–‡ä»¶ï¼ˆæ¨¡æ¿ï¼‰å¯ä»¥æäº¤
- âœ… å›¢é˜Ÿé€šè¿‡å…¶ä»–æ–¹å¼å…±äº«æ•°æ®åº“å‡­æ®ï¼ˆå¦‚å¯†ç ç®¡ç†å·¥å…·ã€å›¢é˜Ÿæ–‡æ¡£ï¼‰

### Q: å¦‚ä½•ä¿è¯å›¢é˜Ÿæˆå‘˜çš„æ•°æ®åº“ç»“æ„ä¸€è‡´ï¼Ÿ

**ç­”ï¼šä½¿ç”¨ Prisma è¿ç§»**

```bash
# ä»»ä½•æ—¶å€™æ‹‰å–ä»£ç åéƒ½è¿è¡Œï¼š
npx prisma migrate dev
npx prisma generate
```

### Q: æµ‹è¯•æ—¶éœ€è¦é‡ç½®æ•°æ®åº“æ€ä¹ˆåŠï¼Ÿ

```bash
# âš ï¸ è­¦å‘Šï¼šä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼
npx prisma migrate reset

# é‡æ–°å¡«å……ç§å­æ•°æ®
npm run db:seed
npm run db:create-tickets
```

### Q: å¦‚ä½•æŸ¥çœ‹å½“å‰æ•°æ®åº“å†…å®¹ï¼Ÿ

```bash
# å¯åŠ¨ Prisma Studio
npm run db:studio

# åœ¨æµè§ˆå™¨æ‰“å¼€ http://localhost:5555
```

---

**è®°å¾—å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼** ğŸ“¦
