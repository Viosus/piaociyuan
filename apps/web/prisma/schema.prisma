// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// âœ… æ´»åŠ¨è¡¨
model Event {
  id        Int      @id @default(autoincrement())
  name      String
  category  String   @default("concert")  // concert(æ¼”å”±ä¼š), festival(éŸ³ä¹èŠ‚), exhibition(å±•è§ˆ), musicale(éŸ³ä¹ä¼š), show(æ¼”å‡º), sports(ä½“è‚²èµ›äº‹), other(å…¶ä»–)
  city      String
  venue     String
  date      String   // æ¼”å‡ºæ—¥æœŸ
  time      String   // æ¼”å‡ºæ—¶é—´

  // å”®ç¥¨çŠ¶æ€å’Œæ—¶é—´æ§åˆ¶
  saleStatus    String   @default("on_sale")  // not_started(æœªå¼€å”®), on_sale(å”®ç¥¨ä¸­), paused(æš‚åœå”®ç¥¨), sold_out(å·²å”®ç½„), ended(å·²ç»“æŸ)
  saleStartTime DateTime @default(now())      // å¼€å”®æ—¶é—´
  saleEndTime   DateTime @default(now())      // åœå”®æ—¶é—´ï¼ˆé€šå¸¸ä¸ºæ¼”å‡ºå‰1å¤©ï¼‰

  cover     String
  artist    String   // è‰ºäºº/ä¸»åŠæ–¹/ç­–å±•äºº
  desc      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tiers     Tier[]
  nfts      NFT[]   // è¯¥æ´»åŠ¨ç›¸å…³çš„NFT
  posts     Post[]
  followers EventFollow[]
  notifications Notification[]
  homepageSections HomepageSectionEvent[]

  @@map("events")
  @@index([category])
  @@index([date])
}

// âœ… ç¥¨æ¡£è¡¨
model Tier {
  id        Int      @id @default(autoincrement())
  eventId   Int
  name      String
  price     Int
  capacity  Int
  remaining Int
  sold      Int      @default(0) // å·²å”®æ•°é‡
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  orders    Order[]

  @@map("tiers")
  @@index([eventId])
}

// âœ… é”ç¥¨è¡¨
model Hold {
  id        String   @id
  eventId   String
  tierId    String
  qty       Int
  expireAt  BigInt
  createdAt BigInt

  @@map("holds")
  @@index([eventId, tierId])
  @@index([expireAt])
}

// âœ… è®¢å•è¡¨
model Order {
  id              String   @id
  userId          String
  eventId         String
  tierId          String
  qty             Int
  holdId          String
  status          String
  createdAt       BigInt
  paidAt          BigInt?

  // ============ æ”¯ä»˜ä¿¡æ¯ï¼ˆæ–°å¢ï¼‰============
  paymentMethod   String?  // wechat, alipay, mock
  transactionId   String?  // ç¬¬ä¸‰æ–¹æ”¯ä»˜äº¤æ˜“å·
  refundedAt      BigInt?  // é€€æ¬¾æ—¶é—´
  refundId        String?  // é€€æ¬¾å•å·

  user      User     @relation(fields: [userId], references: [id], onDelete: Restrict)
  tier      Tier     @relation(fields: [tierId], references: [id], onDelete: Restrict)
  tickets   Ticket[]

  @@map("orders")
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@index([transactionId])
}

// âœ… ç¥¨è¡¨ï¼ˆå¢åŠ NFTç»‘å®šï¼‰
model Ticket {
  id          String   @id @default(uuid())
  ticketCode  String   @unique
  seatNumber  String?
  eventId     Int
  tierId      Int
  holdId      String?
  orderId     String?
  userId      String?
  status      String
  price       Int

  purchasedAt DateTime?
  usedAt      DateTime?
  refundedAt  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // ============ NFTç»‘å®šï¼ˆæ–°å¢ï¼‰============
  nftId               String?  // ç»‘å®šçš„NFT IDï¼ˆå¦‚3Dç¥¨æ ¹NFTï¼‰
  nftMintStatus       String?  // è¯¥ç¥¨çš„NFTé“¸é€ çŠ¶æ€ pending/minted/failed
  nftUserNftId        String?  // å¯¹åº”çš„UserNFTè®°å½•ID

  // å…³è”
  order       Order?   @relation(fields: [orderId], references: [id], onDelete: SetNull)
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  nft         NFT?     @relation(fields: [nftId], references: [id], onDelete: SetNull)

  @@map("tickets")
  @@index([eventId])
  @@index([tierId])
  @@index([holdId])
  @@index([orderId])
  @@index([userId])
  @@index([status])
  @@index([ticketCode])
  @@index([eventId, tierId, status, seatNumber])
  @@index([nftId])
  @@index([nftMintStatus])
}

// âœ… ç”¨æˆ·è¡¨ï¼ˆæ‰©å±•ä¸ªäººä¿¡æ¯å’Œé’±åŒ…ï¼‰
model User {
  id            String   @id @default(uuid())
  email         String?  @unique
  phone         String?  @unique
  password      String?
  nickname      String?
  avatar        String?

  // ç¬¬ä¸‰æ–¹ç™»å½•
  wechatOpenId  String?  @unique
  qqOpenId      String?  @unique
  authProvider  String   @default("local")

  // ç”¨æˆ·è§’è‰²
  role          String   @default("user")

  // ============ ä¸ªäººä¿¡æ¯æ‰©å±•ï¼ˆæ–°å¢ï¼‰============
  bio                 String?  @db.Text // ä¸ªäººç®€ä»‹
  coverImage          String?  // ä¸ªäººä¸»é¡µå°é¢å›¾
  website             String?  // ä¸ªäººç½‘ç«™
  location            String?  // æ‰€åœ¨åœ°

  // ============ è®¤è¯ç³»ç»Ÿï¼ˆæ–°å¢ï¼‰============
  isVerified          Boolean  @default(false)
  verifiedType        String?  // celebrity, artist, organizer, official
  verifiedAt          DateTime?
  verificationBadge   String?  // è®¤è¯å¾½ç« å›¾æ ‡URL

  // ============ é’±åŒ…ä¿¡æ¯ï¼ˆä¿®æ”¹ï¼‰============
  walletAddress       String?  @unique
  walletProvider      String?  // metamask, imtoken, tokenpocket, bitkeep, etc.
  walletConnectedAt   DateTime?

  // ============ ç»Ÿè®¡å­—æ®µï¼ˆæ–°å¢ï¼‰============
  nftCount            Int      @default(0)
  followerCount       Int      @default(0)
  followingCount      Int      @default(0)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // å…³è”
  orders        Order[]
  tickets       Ticket[]
  userNFTs      UserNFT[]   // æ”¹ä¸º userNFTs
  loginLogs     LoginLog[]
  sessions      UserSession[]

  // ç¤¾äº¤
  posts         Post[]
  likes         PostLike[]
  comments      Comment[]
  reports       PostReport[]
  favoritePosts PostFavorite[]
  sentMessages  Message[]      @relation("SentMessages")
  receivedMessages Message[]   @relation("ReceivedMessages")
  conversations ConversationParticipant[]

  // å…³æ³¨
  followedEvents EventFollow[]
  notifications  Notification[]

  // ç”¨æˆ·å…³æ³¨å…³ç³»
  followers      UserFollow[]   @relation("UserFollowers")  // å…³æ³¨æˆ‘çš„äºº
  following      UserFollow[]   @relation("UserFollowing")  // æˆ‘å…³æ³¨çš„äºº

  // NFT
  nftMintQueue   NFTMintQueue[]

  // è®¤è¯ç”³è¯·
  verificationRequests VerificationRequest[]

  @@map("users")
  @@index([email])
  @@index([phone])
  @@index([wechatOpenId])
  @@index([qqOpenId])
  @@index([walletAddress])
}

// âœ… ç™»å½•æ—¥å¿—è¡¨
model LoginLog {
  id         String   @id @default(uuid())
  userId     String
  ipAddress  String?
  userAgent  String?
  location   String?
  success    Boolean  @default(true)
  failReason String?
  createdAt  DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("login_logs")
  @@index([userId])
  @@index([createdAt])
  @@index([success])
}

// âœ… ç”¨æˆ·ä¼šè¯è¡¨
model UserSession {
  id            String   @id @default(uuid())
  userId        String
  refreshToken  String   @unique
  deviceInfo    String?
  ipAddress     String?
  expiresAt     DateTime
  revoked       Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_sessions")
  @@index([userId])
  @@index([expiresAt])
  @@index([refreshToken])
}

// âœ… éªŒè¯ç è¡¨
model VerificationCode {
  id        String   @id @default(uuid())
  email     String
  code      String
  type      String   @default("register")
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("verification_codes")
  @@index([email, type])
  @@index([expiresAt])
}

// âœ… NFTè¡¨ï¼ˆåŸBadgeè¡¨é‡æ„ï¼‰
model NFT {
  id                  String   @id @default(uuid())
  name                String
  description         String   @db.Text
  imageUrl            String

  // ============ NFTåˆ†ç±» ============
  sourceType          String   // ticket_reward, standalone, airdrop
  category            String   // badge, ticket_stub, poster, certificate, art

  // ============ å…³è”ä¿¡æ¯ ============
  eventId             Int?
  tierId              Int?

  // ============ ç»æµæ¨¡å‹ ============
  rarity              String   @default("common")
  price               Int?     // ç‹¬ç«‹å”®å–ä»·æ ¼
  totalSupply         Int      // æ€»ä¾›åº”é‡
  mintedCount         Int      @default(0)

  // ============ 3D/AR åŠŸèƒ½ ============
  has3DModel          Boolean  @default(false)
  model3DUrl          String?
  modelFormat         String?
  hasAR               Boolean  @default(false)
  arUrl               String?
  hasAnimation        Boolean  @default(false)
  animationUrl        String?
  modelConfig         String?  @db.Text

  // ============ åŒºå—é“¾ä¿¡æ¯ ============
  contractAddress     String?
  tokenIdStart        Int?
  metadataUriTemplate String?  @db.Text

  // ============ çŠ¶æ€æ§åˆ¶ ============
  isActive            Boolean  @default(true)
  isMintable          Boolean  @default(true)
  isMarketable        Boolean  @default(false)

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  // å…³è”
  event               Event?   @relation(fields: [eventId], references: [id], onDelete: SetNull)
  userNFTs            UserNFT[]
  ticketsWithNFT      Ticket[]

  @@map("nfts")
  @@index([eventId])
  @@index([sourceType])
  @@index([category])
  @@index([rarity])
  @@index([isActive])
  @@index([isMintable])
}

// âœ… ç”¨æˆ·NFTè¡¨ï¼ˆåŸUserBadgeè¡¨é‡æ„ï¼‰
model UserNFT {
  id                  String   @id @default(uuid())
  userId              String
  nftId               String

  // ============ è·å¾—æ–¹å¼ ============
  sourceType          String   // ticket_purchase, direct_purchase, airdrop, transfer
  sourceId            String?  // æ¥æºIDï¼ˆè®¢å•IDã€ç¥¨IDã€äº¤æ˜“å“ˆå¸Œç­‰ï¼‰

  // ============ åŒºå—é“¾å”¯ä¸€æ ‡è¯† ============
  contractAddress     String   // åˆçº¦åœ°å€
  tokenId             Int      // Token ID
  metadataUri         String?  @db.Text

  // ============ æ‰€æœ‰æƒä¿¡æ¯ ============
  ownerWalletAddress  String   // å½“å‰é“¾ä¸Šæ‰€æœ‰è€…
  isOnChain           Boolean  @default(false)

  // ============ é“¸é€ ä¿¡æ¯ ============
  mintStatus          String   @default("pending")
  mintTransactionHash String?
  mintedAt            DateTime?
  mintError           String?  @db.Text

  // ============ è½¬ç§»ä¿¡æ¯ ============
  isTransferred       Boolean  @default(false)
  transferredTo       String?
  transferredAt       DateTime?

  // ============ é¢å¤–æ•°æ® ============
  metadata            String?  @db.Text // JSONæ ¼å¼

  obtainedAt          DateTime @default(now())
  lastSyncedAt        DateTime?

  // å…³è”
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  nft                 NFT      @relation(fields: [nftId], references: [id], onDelete: Restrict)

  @@map("user_nfts")
  @@unique([contractAddress, tokenId])
  @@index([userId])
  @@index([nftId])
  @@index([ownerWalletAddress])
  @@index([mintStatus])
  @@index([obtainedAt])
  @@index([sourceType])
}

// ==================== ç¤¾äº¤ç³»ç»Ÿ ====================

model Post {
  id          String   @id @default(uuid())
  userId      String
  content     String   @db.Text
  eventId     Int?
  location    String?
  viewCount   Int      @default(0)
  likeCount   Int      @default(0)
  commentCount Int     @default(0)
  isVisible   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  event       Event?     @relation(fields: [eventId], references: [id], onDelete: SetNull)
  images      PostImage[]
  likes       PostLike[]
  comments    Comment[]
  views       PostView[]
  reports     PostReport[]
  favorites   PostFavorite[]

  @@map("posts")
  @@index([userId])
  @@index([eventId])
  @@index([createdAt])
  @@index([likeCount])
  @@index([isVisible])
}

model PostImage {
  id        String   @id @default(uuid())
  postId    String
  imageUrl  String
  width     Int?
  height    Int?
  order     Int      @default(0)
  createdAt DateTime @default(now())

  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@map("post_images")
  @@index([postId])
  @@index([order])
}

model PostLike {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())

  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("post_likes")
  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
  @@index([createdAt])
}

model PostView {
  id        String   @id @default(uuid())
  postId    String
  userId    String?
  ipAddress String?
  createdAt DateTime @default(now())

  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@map("post_views")
  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
  @@index([createdAt])
}

model Comment {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  content   String   @db.Text
  parentId  String?
  likeCount Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post      Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent    Comment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   Comment[] @relation("CommentReplies")

  @@map("comments")
  @@index([postId])
  @@index([userId])
  @@index([parentId])
  @@index([createdAt])
}

model PostReport {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  reason    String   @db.Text
  status    String   @default("pending")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("post_reports")
  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model PostFavorite {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())

  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("post_favorites")
  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
  @@index([createdAt])
}

// ==================== èŠå¤©ç³»ç»Ÿï¼ˆç§èŠ + ç¾¤èŠï¼‰ ====================

model Conversation {
  id            String   @id @default(uuid())
  type          String   @default("private") // private(ç§èŠ), group(ç¾¤èŠ)
  name          String?  // ç¾¤åç§°ï¼ˆç¾¤èŠæ—¶ä½¿ç”¨ï¼‰
  avatar        String?  // ç¾¤å¤´åƒ
  description   String?  // ç¾¤æè¿°
  creatorId     String?  // ç¾¤åˆ›å»ºè€…ID
  maxMembers    Int      @default(500) // æœ€å¤§æˆå‘˜æ•°
  memberCount   Int      @default(0) // å½“å‰æˆå‘˜æ•°
  lastMessageAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  participants ConversationParticipant[]
  messages     Message[]

  @@map("conversations")
  @@index([type])
  @@index([creatorId])
  @@index([lastMessageAt])
}

model ConversationParticipant {
  id             String   @id @default(uuid())
  conversationId String
  userId         String
  role           String   @default("member") // owner(ç¾¤ä¸»), admin(ç®¡ç†å‘˜), member(æˆå‘˜)
  nickname       String?  // ç¾¤å†…æ˜µç§°
  isMuted        Boolean  @default(false) // æ˜¯å¦è¢«ç¦è¨€
  unreadCount    Int      @default(0)
  lastReadAt     DateTime @default(now())
  joinedAt       DateTime @default(now())

  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("conversation_participants")
  @@unique([conversationId, userId])
  @@index([conversationId])
  @@index([userId])
  @@index([role])
}

model Message {
  id             String   @id @default(uuid())
  conversationId String
  senderId       String
  receiverId     String?  // ç§èŠæ—¶ä¸ºæ¥æ”¶è€…IDï¼Œç¾¤èŠæ—¶ä¸ºç©º
  content        String   @db.Text
  messageType    String   @default("text") // text, image, file, system
  isRead         Boolean  @default(false)
  readBy         String?  @db.Text // ç¾¤èŠæ—¶è®°å½•å·²è¯»æˆå‘˜IDåˆ—è¡¨ï¼ˆJSONæ•°ç»„ï¼‰
  createdAt      DateTime @default(now())

  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User         @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver       User?        @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@map("messages")
  @@index([conversationId])
  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
  @@index([isRead])
}

// ==================== å…³æ³¨ç³»ç»Ÿ ====================

model EventFollow {
  id        String   @id @default(uuid())
  userId    String
  eventId   Int
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_follows")
  @@unique([userId, eventId])
  @@index([userId])
  @@index([eventId])
  @@index([createdAt])
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  type      String
  title     String
  content   String   @db.Text
  eventId   Int?
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event     Event?   @relation(fields: [eventId], references: [id], onDelete: SetNull)

  @@map("notifications")
  @@index([userId])
  @@index([eventId])
  @@index([type])
  @@index([isRead])
  @@index([createdAt])
}

// ==================== NFTç³»ç»Ÿ ====================

model NFTMintQueue {
  id            String   @id @default(uuid())
  userNftId     String   // å…³è”UserNFT
  userId        String
  walletAddress String
  status        String   @default("pending")
  retryCount    Int      @default(0)
  errorMessage  String?  @db.Text
  createdAt     DateTime @default(now())
  processedAt   DateTime?

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("nft_mint_queue")
  @@index([userNftId])
  @@index([status])
  @@index([createdAt])
  @@index([userId])
}

model NFTTransaction {
  id                String   @id @default(uuid())
  transactionHash   String   @unique
  fromAddress       String?
  toAddress         String?
  tokenId           Int?
  contractAddress   String?
  transactionType   String
  blockNumber       BigInt?
  gasUsed           BigInt?
  gasPrice          BigInt?
  status            String
  createdAt         DateTime @default(now())
  confirmedAt       DateTime?

  @@map("nft_transactions")
  @@index([transactionHash])
  @@index([transactionType])
  @@index([toAddress])
  @@index([status])
}

model NFTConfig {
  id          String   @id @default(uuid())
  key         String   @unique
  value       String?  @db.Text
  description String?  @db.Text
  updatedAt   DateTime @default(now()) @updatedAt

  @@map("nft_config")
  @@index([key])
}

// âœ… ç”¨æˆ·å…³æ³¨è¡¨
model UserFollow {
  id          String   @id @default(uuid())
  followerId  String   // å…³æ³¨è€…ID
  followingId String   // è¢«å…³æ³¨è€…ID
  createdAt   DateTime @default(now())

  follower    User     @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("UserFollowers", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@map("user_follows")
  @@index([followerId])
  @@index([followingId])
  @@index([createdAt])
}

// âœ… èº«ä»½è®¤è¯ç”³è¯·è¡¨
model VerificationRequest {
  id              String   @id @default(uuid())
  userId          String
  verifiedType    String   // celebrity, artist, organizer, official
  realName        String   // çœŸå®å§“å
  idCard          String?  // èº«ä»½è¯å·ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
  organization    String?  // æ‰€å±æœºæ„/å…¬å¸
  proofImages     String   @db.Text // è¯æ˜ææ–™å›¾ç‰‡URLsï¼ˆJSONæ•°ç»„ï¼‰
  reason          String   @db.Text // ç”³è¯·ç†ç”±
  status          String   @default("pending") // pending, approved, rejected
  reviewedBy      String?  // å®¡æ ¸äººID
  reviewedAt      DateTime?
  rejectReason    String?  @db.Text // æ‹’ç»ç†ç”±
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("verification_requests")
  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

// ==================== é¦–é¡µæ ç›®ç®¡ç† ====================

// é¦–é¡µæ ç›®è¡¨
model HomepageSection {
  id          String   @id @default(uuid())
  title       String   // æ ç›®æ ‡é¢˜ï¼Œå¦‚"çŒœä½ å–œæ¬¢"ã€"æ¼”å”±ä¼šä¸“åŒº"
  subtitle    String?  // å‰¯æ ‡é¢˜ï¼Œå¦‚"æ ¹æ®ä½ çš„å…´è¶£ä¸ºä½ æ¨è"
  icon        String?  // å›¾æ ‡emojiï¼Œå¦‚"âœ¨"ã€"ğŸ¤"
  bgGradient  String   @default("from-purple-50 to-pink-50") // Tailwindæ¸å˜ç±»
  moreLink    String?  // "æŸ¥çœ‹æ›´å¤š"é“¾æ¥
  order       Int      // æ˜¾ç¤ºé¡ºåº
  isActive    Boolean  @default(true) // æ˜¯å¦å¯ç”¨
  type        String   @default("manual") // manual(æ‰‹åŠ¨), auto_category(è‡ªåŠ¨æŒ‰åˆ†ç±»), auto_status(è‡ªåŠ¨æŒ‰çŠ¶æ€)
  autoConfig  String?  @db.Text // è‡ªåŠ¨é…ç½®ï¼ˆJSONï¼‰ï¼Œå¦‚ {"category": "concert", "limit": 6}
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  events      HomepageSectionEvent[]

  @@map("homepage_sections")
  @@index([order])
  @@index([isActive])
}

// é¦–é¡µæ ç›®æ´»åŠ¨å…³è”è¡¨
model HomepageSectionEvent {
  id        String   @id @default(uuid())
  sectionId String   // æ‰€å±æ ç›®
  eventId   Int      // æ´»åŠ¨ID
  order     Int      // åœ¨æ ç›®ä¸­çš„æ˜¾ç¤ºé¡ºåº
  createdAt DateTime @default(now())

  section   HomepageSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  event     Event           @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("homepage_section_events")
  @@unique([sectionId, eventId])
  @@index([sectionId])
  @@index([eventId])
  @@index([order])
}

// ==================== ç¥¨åŠ¡è½¬è®©ç³»ç»Ÿ ====================

// ç¥¨åŠ¡è½¬è®©è®°å½•è¡¨
model TicketTransfer {
  id              String   @id @default(uuid())
  ticketId        String   // è½¬è®©çš„é—¨ç¥¨ID
  fromUserId      String   // è½¬è®©äºº
  toUserId        String?  // æ¥æ”¶äººï¼ˆç¡®è®¤åå¡«å†™ï¼‰
  toUserPhone     String?  // æ¥æ”¶äººæ‰‹æœºå·ï¼ˆç”¨äºçŸ­ä¿¡é€šçŸ¥ï¼‰
  toUserEmail     String?  // æ¥æ”¶äººé‚®ç®±ï¼ˆç”¨äºé‚®ä»¶é€šçŸ¥ï¼‰
  transferCode    String   @unique // è½¬è®©ç ï¼ˆç”¨äºæ¥æ”¶ï¼‰
  message         String?  @db.Text // è½¬è®©ç•™è¨€
  transferType    String   @default("gift") // gift(èµ é€), sale(è½¬è®©)
  price           Int?     // è½¬è®©ä»·æ ¼ï¼ˆä»…è½¬è®©æ—¶ï¼‰
  status          String   @default("pending") // pending(å¾…æ¥æ”¶), accepted(å·²æ¥æ”¶), rejected(å·²æ‹’ç»), expired(å·²è¿‡æœŸ), cancelled(å·²å–æ¶ˆ)
  expiresAt       DateTime // è¿‡æœŸæ—¶é—´
  acceptedAt      DateTime?
  rejectedAt      DateTime?
  cancelledAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("ticket_transfers")
  @@index([ticketId])
  @@index([fromUserId])
  @@index([toUserId])
  @@index([transferCode])
  @@index([status])
  @@index([expiresAt])
}

// ==================== é¦–é¡µè½®æ’­å¹¿å‘Šæ  ====================

// é¦–é¡µ Hero Banner è½®æ’­å›¾
model HeroBanner {
  id        String   @id @default(uuid())
  title     String   // æ ‡é¢˜ï¼Œå¦‚"éŸ³ä¹èŠ‚ç‹‚æ¬¢å­£"
  subtitle  String   // å‰¯æ ‡é¢˜ï¼Œå¦‚"æ„Ÿå—éŸ³ä¹çš„åŠ›é‡ï¼Œé‡Šæ”¾é’æ˜¥çš„æ¿€æƒ…"
  image     String   // å›¾ç‰‡URL
  link      String   // ç‚¹å‡»è·³è½¬é“¾æ¥
  color     String   @default("from-purple-600/80 to-pink-600/80") // Tailwindæ¸å˜é®ç½©ç±»
  order     Int      // æ˜¾ç¤ºé¡ºåº
  isActive  Boolean  @default(true) // æ˜¯å¦å¯ç”¨
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("hero_banners")
  @@index([order])
  @@index([isActive])
}
